<div class="flex flex-col min-h-screen bg-gray-50 text-gray-800">

    <header class="flex justify-between items-center p-4 bg-white shadow-sm border-b">
        <div class="text-2xl font-bold text-blue-600">SportZoom</div>
        <nav class="flex gap-4 items-center">
            <button class="hover:text-blue-600 transition">Carrito</button>
            <button class="hover:text-blue-600 transition">Pedidos</button>
            <button class="hover:text-blue-600 transition">Vender</button>

            <!-- usuario logueado -->
            <ng-container *ngIf="usuario; else loginBtn">
                <span class="font-semibold">{{ usuario.username }}</span>
                <button (click)="logout()" class="rounded-full border p-1 hover:bg-gray-100 transition">Cerrar sesión</button>
            </ng-container>
        
            <!-- usuario no logueado -->
            <ng-template #loginBtn>
                <a routerLink="/login" class="rounded-full border p-1 hover:bg-gray-100 transition">Iniciar sesión</a>
            </ng-template>
        </nav>
    </header>

    <!-- Contenido principal -->
    <div class="flex flex-1 flex-col lg:flex-row gap-6 p-6">

        <!-- Filtro -->
        <aside class="w-full lg:w-64 bg-white border rounded-xl p-4 shadow-sm">
        <h2 class="font-semibold text-lg mb-3">Filtros</h2>

        <!-- Búsqueda por nombre -->
        <input type="text" placeholder="Buscar producto..." [(ngModel)]="filtroNombre"
            class="w-full border rounded-lg p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-300" />

        <!-- Filtro por marca -->
        <input type="text" placeholder="Marca..." [(ngModel)]="filtroMarca"
            class="w-full border rounded-lg p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-300" />

        <!-- Filtro por talla -->
        <input type="text" placeholder="Talla..." [(ngModel)]="filtroTalla"
            class="w-full border rounded-lg p-2 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-300" />

        <!-- Rango de precios -->
        <div class="flex gap-2 mb-3">
            <input type="number" placeholder="Mín $" [(ngModel)]="precioMin"
                class="w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-300" />
            <input type="number" placeholder="Máx $" [(ngModel)]="precioMax"
                class="w-full border rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-300" />
        </div>

        <button (click)="aplicarFiltros()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
            Aplicar filtros
        </button>

        <button (click)="limpiarFiltros()" class="mt-2 w-full bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition">
            Limpiar filtros
        </button>
        </aside>


        <!-- productos -->
        <main class="flex-1 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 auto-rows-min">

            <!-- Cargando -->
            <p *ngIf="cargando" class="col-span-full text-center text-gray-500">
                Cargando productos...
            </p>

            <!-- Productos -->
            <div *ngFor="let p of filtrarProductos()" (click)="verDetalle(p)"
                [class.border-blue-500]="productoSeleccionado === p"
                class="border bg-white rounded-xl shadow-sm hover:shadow-md transition p-4 flex flex-col">

                <img [src]="p.imagen" [alt]="p.nombre" class="w-full h-36 object-cover rounded-lg mb-3" />

                <div class="flex-1">
                    <h3 class="font-semibold text-lg truncate">{{ p.nombre }}</h3>
                    <p class="text-green-600 font-bold">{{ p.precio | currency:'COP ':'symbol':'1.0-0' }}</p>
                    <p class="text-gray-600 text-sm">Stock: {{ p.stock }}</p>
                </div>

                <button (click)="agregarAlCarrito(p); $event.stopPropagation()" [disabled]="p.stock === 0"
                    class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition disabled:opacity-50">
                    {{ p.stock > 0 ? 'Añadir al carrito' : 'Agotado' }}
                </button>
            </div>

            <p *ngIf="!cargando && filtrarProductos().length === 0" class="col-span-full text-center text-gray-500">
                No hay productos disponibles.
            </p>
        </main>

        <!-- Panel de la derecha -->
        <aside class="w-full lg:w-96 flex flex-col gap-6">

            <!-- Detalle del producto -->
            <section class="border rounded-xl bg-white shadow-sm p-5">
                <h2 class="font-bold text-xl mb-3 text-gray-800 border-b pb-2">Detalle del producto</h2>

                <div *ngIf="productoSeleccionado; else sinSeleccion" class="space-y-3">
                    <img [src]="productoSeleccionado.imagen" [alt]="productoSeleccionado.nombre"
                        class="w-full h-48 object-cover rounded-lg border" />

                    <h3 class="font-bold text-lg text-gray-900">{{ productoSeleccionado.nombre }}</h3>
                    <p class="text-green-600 font-semibold text-lg">
                        {{ productoSeleccionado.precio | currency:'COP ':'symbol':'1.0-0' }}
                    </p>
                    <p class="text-sm text-gray-600">Stock disponible: {{ productoSeleccionado.stock }}</p>
                    <p><strong>Marca:</strong> {{ productoSeleccionado.marca }}</p>
                    <p><strong>Talla:</strong> {{ productoSeleccionado.talla }}</p>

                    <div class="text-sm text-gray-700 leading-relaxed border-t pt-2">
                        <strong>Descripción:</strong><br>
                        {{ productoSeleccionado.descripcion || 'Sin descripción disponible.' }}
                    </div>

                    <button (click)="agregarAlCarrito(productoSeleccionado)"
                        class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                        Añadir al carrito
                    </button>
                </div>

                <ng-template #sinSeleccion>
                    <p class="text-gray-500 text-sm mt-10 text-center">
                        Selecciona un producto para ver los detalles
                    </p>
                </ng-template>
            </section>

            <!-- Panel de Administración  -->
            <section *ngIf="usuario?.es_admin" class="border rounded-xl bg-white shadow-sm p-5">
                <h2 class="font-bold text-xl mb-4 text-gray-800 border-b pb-2">Panel de Administración</h2>

                <!-- Crear y Editar Producto -->
                <form (ngSubmit)="guardarProducto()" class="space-y-3">
                    <input type="text" placeholder="Nombre" [(ngModel)]="productoForm.nombre" name="nombre"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <textarea placeholder="Descripción" [(ngModel)]="productoForm.descripcion" name="descripcion"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200"></textarea>

                    <input type="number" placeholder="Precio" [(ngModel)]="productoForm.precio" name="precio"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <input type="number" placeholder="Stock" [(ngModel)]="productoForm.stock" name="stock"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <input type="text" placeholder="Marca" [(ngModel)]="productoForm.marca" name="marca"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <input type="text" placeholder="Talla" [(ngModel)]="productoForm.talla" name="talla"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <input type="file" (change) ="onFileSelected($event)" accept="imagen/*"
                        class="w-full border p-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-200">

                    <button type="submit"
                        class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">
                        {{ productoForm.id ? 'Actualizar Producto' : 'Agregar Producto' }}
                    </button>
                </form>

                <!-- Lista de productos -->
                <div class="mt-6">
                    <h3 class="font-semibold text-gray-700 mb-2">Productos existentes</h3>
                    <div *ngFor="let p of productos"
                        class="border rounded-lg p-3 flex justify-between items-center hover:bg-gray-50 transition">
                        <span class="truncate">{{ p.nombre }}</span>
                        <div class="flex gap-2">
                            <button (click)="editarProducto(p)"
                                class="bg-yellow-400 text-white px-3 py-1 rounded hover:bg-yellow-500 transition">
                                Editar
                            </button>
                            <button (click)="p.id && eliminarProducto(p.id)"
                                class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition">
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </section>

        </aside>

    </div>

    <footer class="text-center p-4 bg-white border-t mt-auto text-sm text-gray-600">
        © 2025 SportZoom — Todos los derechos reservados
    </footer>

</div>